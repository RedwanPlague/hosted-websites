(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{"4a78":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"row"},[a("div",{staticClass:"text-h5 q-my-md col-6"},[e._v("\n      Assign Fees\n    ")])]),a("div",{staticClass:"row q-col-gutter-md q-pb-sm"},[a("q-select",{staticClass:"col-6",attrs:{label:"Fee Type",outlined:"",options:e.feeOptions,rules:[function(){return!!e.feeType||"Please Select Fee Type"}]},model:{value:e.feeType,callback:function(t){e.feeType=t},expression:"feeType"}})],1),e.feeType?a("q-form",{staticClass:"row q-col-gutter-md",on:{submit:e.checkAssignFee,reset:e.resetForm}},[a("session-field",{attrs:{classes:"col-6",label:e.feeType===e.DUE_TYPES.DINING_FEE?"Month Year":"Session",required:"",readonly:e.feeType!==e.DUE_TYPES.DINING_FEE,generic:e.feeType===e.DUE_TYPES.DINING_FEE},model:{value:e.yearMonth,callback:function(t){e.yearMonth=t},expression:"yearMonth"}}),a("q-input",{staticClass:"col-6",attrs:{label:"Amount",type:"number",min:"0",outlined:"",rules:[function(){return!!e.amount||"Please Enter Fee Amount"},e.noNegative(e.amount)]},model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}}),a("q-input",{staticClass:"col-6",attrs:{label:"Deadline",outlined:"",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{model:{value:e.deadline,callback:function(t){e.deadline=t},expression:"deadline"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}],null,!1,1699857427),model:{value:e.deadline,callback:function(t){e.deadline=t},expression:"deadline"}}),a("q-input",{staticClass:"col-6",attrs:{label:"Delay Fine",type:"number",min:"0",outlined:"",rules:[function(){return!!e.delayFine||"Please Enter Delay Fine"},e.noNegative(e.delayFine)]},model:{value:e.delayFine,callback:function(t){e.delayFine=t},expression:"delayFine"}}),a("div",{staticClass:"col-12 text-h5"},[e._v("\n      Filters for Batch Assign\n    ")]),a("q-select",{staticClass:"col-12 q-mb-md",attrs:{label:"Student ID(s)",multiple:"","use-chips":"","use-input":"",clearable:"","new-value-mode":"add-unique",outlined:""},model:{value:e.ids,callback:function(t){e.ids=t},expression:"ids"}}),a("department-picker",{attrs:{classes:"col-6",label:"Department"},model:{value:e.dept,callback:function(t){e.dept=t},expression:"dept"}}),a("hall-picker",{attrs:{classes:"col-6",label:"Hall"},model:{value:e.hall,callback:function(t){e.hall=t},expression:"hall"}}),a("q-input",{staticClass:"col-6",attrs:{label:"Level",type:"number",min:"1",max:"4",outlined:""},model:{value:e.level,callback:function(t){e.level=t},expression:"level"}}),a("q-input",{staticClass:"col-6",attrs:{label:"Term",type:"number",min:"1",max:"2",outlined:""},model:{value:e.term,callback:function(t){e.term=t},expression:"term"}}),a("div",{staticClass:"col-12 q-mt-md"},[a("q-btn",{attrs:{label:"Assign",type:"submit",color:"primary",unelevated:"",loading:e.assignInfoLoading}}),a("q-btn",{attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1):e._e(),a("div",{staticStyle:{"min-height":"200px"}}),a("q-dialog",{model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[a("q-card",[a("q-card-section",[e.assignDone?a("div",[a("q-icon",{attrs:{name:"analytics",size:"lg"}}),a("span",{staticClass:"text-h5 vertical-middle q-ml-sm"},[e._v("Batch Process Result")])],1):a("div",[a("q-icon",{attrs:{name:"info",size:"lg"}}),a("span",{staticClass:"text-h5 vertical-middle q-ml-sm"},[e._v("Attention")])],1)]),a("q-separator"),a("q-card-section",[a("div",{staticStyle:{height:"140px",width:"500px"}},[e.assignDone?a("div",[a("q-markup-table",{staticClass:"q-mb-md",attrs:{flat:"",dense:"",separator:"cell"}},[a("tbody",[a("tr",[a("td",{style:e.dialogStyle},[e._v("Total:")]),a("td",{style:e.dialogStyle},[e._v(e._s(e.effectCount))])]),a("tr",[a("td",{style:e.dialogStyle},[e._v("Successful:")]),a("td",{style:Object.assign({},e.dialogStyle,{color:"green"})},[e._v("\n                  "+e._s(e.successCount)+"\n                ")])]),a("tr",[a("td",{style:e.dialogStyle},[e._v("Failed:")]),a("td",{style:Object.assign({},e.dialogStyle,{color:"red"})},[e._v("\n                  "+e._s(e.effectCount-e.successCount)+"\n                ")])])])]),e.allSuccess?e._e():a("span",{style:e.dialogStyle},[e._v("\n              Try again to complete the batch process\n            ")])],1):a("div",{style:e.dialogStyle},[a("span",{staticStyle:{"font-size":"1.2em"}},[e._v(e._s(e.effectCount))]),e._v(" students will be affected by this"),a("br"),e._v("\n            Do you wish to continue?\n          ")])])]),a("q-card-actions",{attrs:{align:"right"}},[e.assignDone?a("div",[e.allSuccess?a("div",[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1):a("div",[a("q-btn",{attrs:{unelevated:"",label:"Try Again",color:"primary"},on:{click:e.assignFee}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}})],1)]):a("div",[a("q-btn",{attrs:{unelevated:"",label:"Continue",color:"primary"},on:{click:e.assignFee}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}})],1)]),a("q-inner-loading",{attrs:{showing:e.assignLoading}})],1)],1)],1)},l=[],n=a("ded3"),i=a.n(n),o=a("0286"),c=a("b2c5"),r=a("c9d9"),d=a("567a"),u=a("d795"),p=a("9053"),m=a("6308");const h={fontSize:"1.2em"};var f={name:"FeeAssignment",components:{HallPicker:p["a"],DepartmentPicker:u["a"],SessionField:d["a"]},data(){return{feeType:null,amount:null,deadline:null,delayFine:null,yearMonth:null,ids:null,dept:null,hall:null,level:null,term:null,effectCount:0,successCount:0,showDialog:!1,assignInfoLoading:!1,assignLoading:!1,assignDone:!1,dialogStyle:h,DUE_TYPES:r["b"],feeOptions:m["a"]}},computed:{allSuccess(){return this.effectCount===this.successCount},filterData(){return{dueType:this.feeType,ids:this.ids&&this.ids.length>0?this.ids:null,department:Object(c["a"])(this.dept),hall:Object(c["a"])(this.hall),level:this.level,term:this.term}}},methods:{noNegative:o["c"],checkAssignFee(){this.assignDone=!1,this.assignInfoLoading=!0,this.$adminAPI.post("/due/batchInfo",this.filterData).then((e=>{this.assignInfoLoading=!1,this.effectCount=e.data.willAffect,this.showDialog=!0})).catch((()=>{this.assignInfoLoading=!1,this.$q.notify({message:"Failed to load batch process info",type:"negative"})}))},assignFee(){this.assignLoading=!0;const e=i()({amount:this.amount,deadline:new Date(this.deadline),delayFine:this.delayFine},this.filterData);this.feeType===r["b"].DINING_FEE?e.yearMonth=new Date(this.yearMonth).toString():e.session=new Date(this.yearMonth).toString(),this.$adminAPI.post("/due/upsert",e).then((e=>{this.assignLoading=!1,this.assignDone=!0,this.successCount=e.data.duesModified})).catch((e=>{this.assignLoading=!1,this.assignDone=!0,this.successCount=e.response.data.duesModified}))},resetForm(){this.amount=null,this.deadline=null,this.delayFine=null,this.yearMonth=null,this.ids=null,this.dept=null,this.hall=null,this.level=null,this.term=null}}},g=f,y=a("2877"),b=a("9989"),v=a("9564"),q=a("ddd8"),C=a("0378"),D=a("27f9"),F=a("0016"),S=a("7cbe"),_=a("52ee"),w=a("9c40"),k=a("24e8"),x=a("f09f"),T=a("a370"),I=a("eb85"),E=a("2bb1"),P=a("4b7e"),Q=a("74f7"),N=a("7f67"),A=a("eebe"),L=a.n(A),M=Object(y["a"])(g,s,l,!1,null,null,null);t["default"]=M.exports;L()(M,"components",{QPage:b["a"],QToggle:v["a"],QSelect:q["a"],QForm:C["a"],QInput:D["a"],QIcon:F["a"],QPopupProxy:S["a"],QDate:_["a"],QBtn:w["a"],QDialog:k["a"],QCard:x["a"],QCardSection:T["a"],QSeparator:I["a"],QMarkupTable:E["a"],QCardActions:P["a"],QInnerLoading:Q["a"]}),L()(M,"directives",{ClosePopup:N["a"]})}}]);